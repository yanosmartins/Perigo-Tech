<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Autentica√ß√£o 2FA</title>
  <link rel="stylesheet" href="2FA.css">
</head>

<body class="dark">
  <!-- Bot√£o de alternar tema no canto superior direito -->
  <button class="theme-toggle" id="toggleTheme">‚òÄÔ∏è</button>

  <div class="container">
    <h2>Verifica√ß√£o 2FA</h2>
    
    <!-- Pergunta aleat√≥ria -->
    <div id="question" class="question"></div>
    
    <!-- Formul√°rio de resposta -->
    <form id="form2fa">
      <input type="text" id="answer" placeholder="Digite sua resposta..." required>
      <button type="submit">Enviar</button>
    </form>
    
    <!-- Mensagem de erro -->
    <div id="message" class="error"></div>
  </div>

  <script>
    // ==== Perguntas poss√≠veis ====
    const perguntas = [
      { id: "mae", texto: "Qual o nome da sua m√£e?" },
      { id: "nascimento", texto: "Qual a data do seu nascimento?" },
      { id: "cep", texto: "Qual o CEP do seu endere√ßo?" }
    ];

    // Seleciona pergunta aleat√≥ria
    let perguntaAtual = perguntas[Math.floor(Math.random() * perguntas.length)];
    document.getElementById("question").innerText = perguntaAtual.texto;

    let tentativas = 0;

    // ==== Valida√ß√£o do formul√°rio ====
    document.getElementById("form2fa").addEventListener("submit", async (e) => {
  e.preventDefault();
  const resposta = document.getElementById("answer").value.trim();
  const messageDiv = document.getElementById("message");

  if (!resposta) {
    messageDiv.innerText = "‚ö†Ô∏è Preencha a resposta.";
    return;
  }

  // Supondo que voc√™ tenha o email do usu√°rio logado
  const usuarioEmail = "usuario@example.com";

  const res = await fetch("verificar_2fa.php", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ pergunta: perguntaAtual.id, resposta, email: usuarioEmail })
  });

  const data = await res.json();

  if (data.sucesso) {
    alert("‚úÖ Autentica√ß√£o bem-sucedida!");
    window.location.href = "/dashboard.php";
  } else {
    tentativas++;
    if (tentativas >= 3) {
      alert("3 tentativas sem sucesso! Favor realizar Login novamente.");
      window.location.href = "/login.php";
    } else {
      messageDiv.innerText = `‚ùå Resposta incorreta. Tentativa ${tentativas}/3`;
      document.getElementById("answer").value = "";
    }
  }
});

    // ==== Alternar tema escuro/claro ====
    const toggleBtn = document.getElementById("toggleTheme");
    toggleBtn.addEventListener("click", () => {
      document.body.classList.toggle("dark");
      document.body.classList.toggle("light");

      // Troca o √≠cone do bot√£o
      if (document.body.classList.contains("dark")) {
        toggleBtn.textContent = "‚òÄÔ∏è"; // Sol para tema escuro
      } else {
        toggleBtn.textContent = "üåô"; // Lua para tema claro
      }
    });

  </script>
</body>
</html>
